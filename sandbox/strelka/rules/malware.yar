rule Suspicious_PE_Imports {
    meta:
        description = "Detects suspicious PE imports"
        severity = "medium"
    strings:
        $api1 = "CreateRemoteThread" ascii
        $api2 = "VirtualAllocEx" ascii
        $api3 = "WriteProcessMemory" ascii
    condition:
        2 of them
}

rule Encoded_PowerShell {
    meta:
        description = "Detects encoded PowerShell commands"
        severity = "high"
    strings:
        $enc1 = "-enc" ascii nocase
        $enc2 = "-encodedcommand" ascii nocase
        $b64 = /[A-Za-z0-9+\/]{50,}={0,2}/ ascii
    condition:
        1 of ($enc*) and $b64
}

rule Macro_AutoOpen {
    meta:
        description = "Office document with AutoOpen macro"
        severity = "high"
    strings:
        $auto1 = "AutoOpen" ascii nocase
        $auto2 = "Auto_Open" ascii nocase
        $shell = "Shell" ascii nocase
        $createobject = "CreateObject" ascii nocase
    condition:
        1 of ($auto*) and 1 of ($shell, $createobject)
}